getIcon = (markerType)->
  iconPath = switch
    when markerType == 'expense' then 'E' 
    when markerType == 'contribution' then 'C' 
    when markerType == 'debt' then 'D'
    when markerType == 'receipt' then 'R'
    else image_path('marker-icon.png')

  return L.icon({
      iconUrl: iconPath,
      shadowUrl: 'assets/marker-shadow.png',
      iconSize: [25, 41],
      shadowSize: [41, 41],
      iconAnchor: [12, 41],
      shadowAnchor: [12, 41],
      popupAnchor: [0, -34]
    })

@loadMarkers = ()->
  L.gridLayer.googleMutant(type: 'roadmap').addTo(map) # Add Google map tiles

  markerData.forEach (markerPoint)->

    console.log( getIcon(markerPoint.marker_type.iconPath).options.iconUrl  )
    markerPoint[markerPoint.id] = L.marker(
        markerPoint.latlng,
        { icon: L.icon.glyph({prefix: '',glyph:  getIcon(markerPoint.marker_type).options.iconUrl  })  }
      ).bindPopup(markerPoint.popup).addTo(map).addEventListener 'click', ->
        $('[id^=filer_id]').removeClass('active')
        $("##{markerPoint.filer_id}").addClass('active')
        $('#collapseTwo').collapse('show')
        return

    markerPoint[markerPoint.id]._icon.id = markerPoint.id;

  map.fitBounds(bounds)

  $('[id^=filer_id]').click ->
    $('[id^=filer_id]').removeClass('active')
    $(this).addClass('active')
    console.log(this.id)
    return
